{"version":3,"sources":["../../../src/api/model/order.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;IAEqB,K;;;;;;;;;;;;gJAEnB,Y,GAAe,C,QACf,Q,GAAW,C,QACX,U,GAAa,C,QACb,a,GAAgB,C,QAChB,U,GAAa,C,QACb,Q,GAAW,C,QACX,Q,GAAW,C;;;AACX;kBACA,M,mBAAO,M,EAAQ,M,EAAO;AACpB,YAAQ,GAAR,CAAY,OAAZ;AACA,WAAO,KAAK,GAAL,CAAS,EAAC,MAAK,MAAN,EAAa,MAAK,MAAlB,EAAyB,QAAO,CAAhC,EAAT,CAAP;AACD,G;;AAED;AACA;;;kBACA,Y,yBAAa,K,EAAM;AACjB,UAAM,MAAN,GAAe,CAAf;AACA,WAAO,KAAK,KAAL,CAAW,EAAC,IAAG,MAAM,EAAV,EAAX,EAA0B,MAA1B,CAAiC,KAAjC,CAAP;AACD,G;AACD;;;kBACM,Y;2FAAa,O;;;;;;;qBACG,KAAK,KAAL,CAAW,EAAC,IAAG,OAAJ,EAAX,EAAyB,IAAzB,E;;;AAAhB,oB,iBAAiD,Q;4BAC9C,M;8CACA,Y,uBAEC,Q,uBAED,U,uBAEA,a,uBAEA,U;;;;+CAPI,KAAK,KAAL,CAAW,EAAC,IAAG,OAAJ,EAAX,EAAyB,MAAzB,CAAgC,EAAC,QAAO,QAAR,EAAhC,C;;;+CAEA,KAAK,KAAL,CAAW,EAAC,IAAG,OAAJ,EAAX,EAAyB,MAAzB,CAAgC,EAAC,QAAO,UAAR,EAAhC,C;;;+CAEA,KAAK,KAAL,CAAW,EAAC,IAAG,OAAJ,EAAX,EAAyB,MAAzB,CAAgC,EAAC,QAAO,aAAR,EAAhC,C;;;+CAEA,KAAK,KAAL,CAAW,EAAC,IAAG,OAAJ,EAAX,EAAyB,MAAzB,CAAgC,EAAC,QAAO,UAAR,EAAhC,C;;;+CAEA,KAAK,KAAL,CAAW,EAAC,IAAG,OAAJ,EAAX,EAAyB,MAAzB,CAAgC,EAAC,QAAO,QAAR,EAAhC,C;;;+CAEA,KAAK,KAAL,CAAW,EAAC,IAAG,OAAJ,EAAX,EAAyB,MAAzB,E;;;;;;;;;;;;;;;;AAGb;;;kBACA,S,sBAAU,O,EAAQ;AAChB,WAAO,KAAK,KAAL,CAAW,EAAC,IAAG,OAAJ,EAAX,EAAyB,MAAzB,CAAgC,EAAC,QAAO,QAAR,EAAhC,CAAP;AACD,G;;kBAED,O,oBAAQ,M,EAAQ;AACd,WAAO,KAAK,IAAL,CAAU,8BAAV,EACJ,KADI,CACE,4EADF,EAEJ,KAFI,CAEE,EAAC,MAAM,MAAP,EAFF,EAGJ,KAHI,CAGE,qBAHF,EAIJ,MAJI,EAAP;AAKD,G;;kBAED,mB,gCAAoB,M,EAAQ;AAC1B,WAAO,KAAK,IAAL,CAAU,8BAAV,EACJ,KADI,CACE,wCADF,EAEJ,KAFI,CAEE,EAAC,MAAM,MAAP,EAFF,EAGJ,KAHI,CAGE,qBAHF,EAIJ,MAJI,EAAP;AAKD,G;;kBAED,U,uBAAW,M,EAAQ;AACjB,WAAO,KAAK,KAAL,CAAW,EAAC,MAAM,MAAP,EAAX,EACJ,KADI,CACE,kBADF,EAEJ,KAFI,CAEE,wCAFF,EAGJ,IAHI,CAGC,8BAHD,EAIJ,KAJI,CAIE,qBAJF,EAKJ,MALI,EAAP;AAMD,G;;kBAED,Y,2BAAe;AACb,WAAO,KAAK,IAAL,CAAU,8BAAV,EACJ,IADI,CACC,8BADD,EAEJ,KAFI,CAEE,oFAFF,EAGJ,KAHI,CAGE,qBAHF,EAIJ,MAJI,EAAP;AAKD,G;;;;;kBA3EkB,K","file":"order.js","sourcesContent":["import Base from './base.js'\r\n\r\nexport default class Order extends Base {\r\n\r\n  WAIT_CONFIRM = 0;\r\n  WAIT_PAY = 1;\r\n  WAIT_CHECK = 2;\r\n  WAIT_DELIEVER = 3;\r\n  DELIEVERED = 4;\r\n  FINISHED = 5;\r\n  CANCELED = 6;\r\n  //添加新订单 地址为默认地址\r\n  addOne(userId, itemId){\r\n    console.log(\"order\");\r\n    return this.add({user:userId,item:itemId,status:0});\r\n  }\r\n\r\n  //确认订单：买家确定地址等信息，订单更新状态\r\n  //未测试\r\n  confirmOrder(order){\r\n    order.status = 1;\r\n    return this.where({id:order.id}).update(order);\r\n  }\r\n  //更改订单状态\r\n  async changeStatus(orderId){\r\n    let status = (await this.where({id:orderId}).find())[\"status\"];\r\n    switch(status){\r\n      case WAIT_CONFIRM:\r\n        return this.where({id:orderId}).update({status:WAIT_PAY});\r\n      case  WAIT_PAY:\r\n        return this.where({id:orderId}).update({status:WAIT_CHECK});\r\n      case WAIT_CHECK:\r\n        return this.where({id:orderId}).update({status:WAIT_DELIEVER});\r\n      case WAIT_DELIEVER:\r\n        return this.where({id:orderId}).update({status:DELIEVERED});\r\n      case DELIEVERED:\r\n        return this.where({id:orderId}).update({status:FINISHED});\r\n      default:\r\n        return this.where({id:orderId}).update();\r\n    }\r\n  }\r\n  //取消订单，改变订单状态为取消\r\n  cancelOne(orderId){\r\n    return this.where({id:orderId}).update({status:CANCELED});\r\n  }\r\n\r\n  getList(userId) {\r\n    return this.join(\"item on order.item = item.id\")\r\n      .field(\"order.id, item.name,item.currentPrice as price,order.createAt,order.status\")\r\n      .where({user: userId})\r\n      .order(\"order.createAt DESC\")\r\n      .select();\r\n  }\r\n\r\n  getConfirmedAuction(userId) {\r\n    return this.join(\"item on order.item = item.id\")\r\n      .field(\"item.name, order.id, item.currentPrice\")\r\n      .where({user: userId})\r\n      .order(\"order.createAt DESC\")\r\n      .select();\r\n  }\r\n\r\n  getWaitPay(userId) {\r\n    return this.where({user: userId})\r\n      .where(\"order.status = 1\")\r\n      .field(\"item.name, order.id, item.currentPrice\")\r\n      .join(\"item on order.item = item.id\")\r\n      .order(\"order.createAt DESC\")\r\n      .select();\r\n  }\r\n\r\n  getListAdmin() {\r\n    return this.join(\"item on order.item = item.id\")\r\n      .join(\"user on order.user = user.id\")\r\n      .field(\"item.id, item.name, item.currentPrice, user.username, order.createAt, order.status\")\r\n      .order(\"order.createAt DESC\")\r\n      .select();\r\n  }\r\n}"]}