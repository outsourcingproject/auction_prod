{"version":3,"sources":["../../../src/api/model/item_group.js"],"names":["ItemGroup","init","args","relation","item","type","think","model","HAS_MANY","key","fKey","order","limit","selectData","id","setRelation","where","find","getList","isOpen","select","getGroupItem","groups","itemGroup","i","g","push","getListAdmin","beforeAdd","data","no","reduce","pre","curr"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;IAEqBA,S;;;;;;;;sBACnBC,I,mBAAa;AAAA;;AAAA,sCAALC,IAAK;AAALA,UAAK;AAAA;;AACX,4CAAMD,IAAN,iDAAcC,IAAd;AACA,SAAKC,QAAL,GAAgB;AACdC,YAAM;AACJC,cAAMC,MAAMC,KAAN,CAAYC,QADd;AAEJC,aAAI,IAFA;AAGJC,cAAK,OAHD;AAIJC,eAAO,eAJH;AAKJC,eAAM,CAAC,EAAD,CALF;AAMJT,kBAAU;AANN;AADQ,KAAhB;AAUD,G;;sBAEDU,U,uBAAWC,E,EACX;AACI,WAAO,KAAKC,WAAL,CAAiB,IAAjB,EAAuBC,KAAvB,CAA6B,UAAQF,EAArC,EAAyCG,IAAzC,EAAP;AACH,G;;AAED;;;sBACAC,O,sBAAS;AACP,WAAO,KAAKH,WAAL,CAAiB,KAAjB,EAAwBC,KAAxB,CAA8B,EAACG,QAAO,CAAR,EAA9B,EAA0CR,KAA1C,CAAgD,eAAhD,EAAiES,MAAjE,EAAP;AACD,G;AACD;;;sBACMC,Y;;;;;;;AACAC,oB,GAAS,E;;qBACS,KAAKJ,OAAL,E;;;AAAlBK,uB;uDACUA,S;;;;;;;;AAALC,e;;qBACQ,KAAKX,UAAL,CAAgBU,UAAUC,CAAV,EAAa,IAAb,CAAhB,C;;;AAAXC,e;;AACJH,qBAAOI,IAAP,CAAYD,CAAZ;;;;;+CAEKH,M;;;;;;;;;;;;;;;;;AAGT;;;sBACAK,Y,2BAAc;AACZ,WAAO,KAAKZ,WAAL,CAAiB,KAAjB,EAAwBJ,KAAxB,CAA8B,eAA9B,EAA+CS,MAA/C,EAAP;AACD,G;;sBAEKQ,S;6FAAUC,I;;;;;;AACdA,qBAAO,gBAAMD,SAAN,YAAgBC,IAAhB,CAAP;;qBACmB,KAAKT,MAAL,E;;;AAAfE,oB;;AACJO,mBAAKC,EAAL,GAAUR,OAAOS,MAAP,CAAc,UAACC,GAAD,EAAMC,IAAN;AAAA,uBAAaD,MAAM,CAACC,KAAKH,EAAZ,GAAiBE,GAAjB,GAAuB,CAACC,KAAKH,EAAN,IAAYE,GAAhD;AAAA,eAAd,EAAmE,CAAnE,IAAwE,CAAlF;gDACOH,I;;;;;;;;;;;;;;;;;;;;kBA5CU7B,S","file":"item_group.js","sourcesContent":["import Base from './base.js'\r\n\r\nexport default class ItemGroup extends Base {\r\n  init(...args){\r\n    super.init(...args);\r\n    this.relation = {\r\n      item: {\r\n        type: think.model.HAS_MANY,\r\n        key:\"id\",\r\n        fKey:\"group\",\r\n        order: \"createAt DESC\",\r\n        limit:[16],\r\n        relation: false\r\n      }\r\n    };\r\n  }\r\n\r\n  selectData(id)\r\n  {\r\n      return this.setRelation(true).where(\"id = \"+id).find();\r\n  }\r\n\r\n  //获取首页显示的列表\r\n  getList(){\r\n    return this.setRelation(false).where({isOpen:1}).order(\"createAt DESC\").select();\r\n  }\r\n  //显示在首页的拍卖物品信息\r\n  async getGroupItem(){\r\n    let groups = [];\r\n    let itemGroup = await this.getList();\r\n    for (let i in itemGroup){\r\n      let g = await  this.selectData(itemGroup[i][\"id\"]);\r\n      groups.push(g);\r\n    }\r\n    return groups;\r\n  }\r\n\r\n  //管理员获取物品列表\r\n  getListAdmin(){\r\n    return this.setRelation(false).order(\"createAt DESC\").select();\r\n  }\r\n\r\n  async beforeAdd(data) {\r\n    data = super.beforeAdd(data);\r\n    let groups = await this.select();\r\n    data.no = groups.reduce((pre, curr)=>pre > +curr.no ? pre : +curr.no || pre, 0) + 1;\r\n    return data;\r\n  }\r\n}  "]}