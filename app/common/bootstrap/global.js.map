{"version":3,"sources":["../../../src/common/bootstrap/global.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;;;;;AAKA;;;;;;;;AAQA;AACA,IAAI,UAAU,QAAQ,SAAR,CAAd;AACA;AACA,IAAI,UAAU,IAAI,OAAJ,EAAd;AACA;AACA,QAAQ,UAAR;;AAGA,IAAI;AAAA,wEAAgB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAGd,8BAHc,GAGO,MAAM,MAAN,CAAa,yBAAb,CAHP;AAId,0BAJc,GAIG,MAAM,KAAN,CAAY,WAAZ,EAAyB,IAAzB,EAA+B,KAA/B,CAJH;AAAA,wBAMI,kBANJ;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;AAMT,qBANS;AAAA;AAAA,mBAOG,eAAe,KAAf,CAAqB,EAAC,MAAM,UAAU,IAAjB,EAArB,EAA6C,IAA7C,EAPH;;AAAA;AAOZ,kBAPY;;AAAA,iBAQZ,MAAM,OAAN,CAAc,MAAd,CARY;AAAA;AAAA;AAAA;;AAAA;AAAA,mBASR,eAAe,YAAf,CAA4B,UAAU,IAAtC,EAA4C,UAAU,IAAtD,EAA4D,UAAU,KAAtE,CATQ;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAhB;;AAAA;AAAA;AAAA;AAAA,GAAJ;AAaA,IAAI;AAAA,yEAAW;AAAA;;AAAA;AAAA;AAAA;AAAA;AAGT,wBAHS,GAGM,MAAM,MAAN,CAAa,mBAAb,CAHN;AAIT,qBAJS,GAIG,MAAM,KAAN,CAAY,MAAZ,EAAoB,IAApB,EAA0B,KAA1B,CAJH;AAAA,yBAMI,YANJ;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;AAMJ,gBANI;AAAA;AAAA,mBAOQ,UAAU,KAAV,CAAgB,EAAC,MAAM,KAAK,IAAZ,EAAhB,EAAmC,IAAnC,EAPR;;AAAA;AAOP,kBAPO;;AAAA,iBAQP,MAAM,OAAN,CAAc,MAAd,CARO;AAAA;AAAA;AAAA;;AAAA;AAAA,mBASH,UAAU,OAAV,CAAkB,KAAK,IAAvB,EAA6B,KAAK,IAAlC,EAAwC,KAAK,MAA7C,EAAqD,KAAK,WAA1D,CATG;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAX;;AAAA;AAAA;AAAA;AAAA,GAAJ;;AAcA,MAAM,cAAN,GAAuB,UAAC,MAAD,EAAW;AAChC,SAAO,MAAM,QAAN,CAAe,MAAf,KAA0B,OAAO,KAAP,CAAa,eAAb,CAAjC;AACD,CAFD;AAGA,MAAM,OAAN,GAAc,OAAd;;AAEA;AACA;AACA,WAAW,IAAX;;AAEA,OAAO,aAAP,GAAuB,UAAC,GAAD,EAAQ;AAC7B,SAAO,IAAI,OAAJ,CAAY,UAAZ,EAAwB,EAAxB,CAAP,CAD6B,CACM;AACpC,CAFD;;AAMA,OAAO,YAAP,8DAAsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAChB,mBADgB,GACJ,MAAM,KAAN,CAAY,MAAZ,EAAmB,IAAnB,EAAwB,KAAxB,CADI;AAAA;AAAA,iBAEd,UAAU,YAAV,EAFc;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAtB;AAIA,eAAe,IAAf","file":"global.js","sourcesContent":["/**\r\n * this file will be loaded before server started\r\n * you can define global functions used in controllers, models, templates\r\n */\r\n\r\n/**\r\n * use global.xxx to define global functions\r\n *\r\n * global.fn1 = function(){\r\n *     \r\n * }\r\n */\r\n\r\n// 载入模块\r\nvar Segment = require('segment');\r\n// 创建实例\r\nvar segment = new Segment();\r\n// 使用默认的识别模块及字典，载入字典文件需要1秒，仅初始化时执行一次即可\r\nsegment.useDefault();\r\n\r\n\r\nlet initAuthority = async()=> {\r\n  \"use strict\";\r\n  \r\n  let defaultAuthorities = think.config('site.defaultAuthorities');\r\n  let authorityModel = think.model('authority', null, 'api');\r\n\r\n  for (let authority of defaultAuthorities) {\r\n    let result = await authorityModel.where({name: authority.name}).find();\r\n    if (think.isEmpty(result)) {\r\n      await authorityModel.addAuthority(authority.name, authority.desc, authority.paths);\r\n    }\r\n  }\r\n};\r\nlet initRole = async()=> {\r\n  \"use strict\";\r\n\r\n  let defaultRoles = think.config('site.defaultRoles');\r\n  let roleModel = think.model('role', null, 'api');\r\n\r\n  for (let role of defaultRoles) {\r\n    let result = await roleModel.where({name: role.name}).find();\r\n    if (think.isEmpty(result)) {\r\n      await roleModel.addRole(role.name, role.desc, role.extend, role.authorities);\r\n    }\r\n  }\r\n};\r\n\r\nthink.isStringExpReg = (string)=> {\r\n  return think.isRegExp(string) || string.match(/^\\/[\\w\\W]+\\/$/);\r\n};\r\nthink.segment=segment;\r\n\r\n//Promise.all([initAuthority(), initRole()]).then();\r\n//initAuthority().then();\r\ninitRole().then();\r\n\r\nglobal.removeHTMLTag = (str)=> {\r\n  return str.replace(/<[^>]+>/g, \"\");//去掉所有的html标记\r\n};\r\n\r\n\r\n\r\nglobal.checkAuction = async() =>{\r\n  let itemModel = think.model(\"item\",null,\"api\");\r\n  await itemModel.checkAuction();\r\n};\r\ncheckAuction().then();"]}